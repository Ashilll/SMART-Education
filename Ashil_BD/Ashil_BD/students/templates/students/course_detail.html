{% extends 'students/base.html' %}
{% block title %}{{ course.title }}{% endblock %}
{% block content %}
<h1>{{ course.title }}</h1>
<p><strong>Преподаватель:</strong> {{ course.teacher }}</p>
<p>{{ course.description }}</p>

<hr>
<h4>Участники</h4>
<table class="table">
  <thead><tr><th>#</th><th>Студент</th><th>Дата записи</th><th>Оценка</th><th>Действия</th></tr></thead>
  <tbody>
    {% for en in enrollments %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td><a href="{% url 'student_detail' en.student.id %}">{{ en.student.name }}</a></td>
      <td>{{ en.enrolled_at|date:"Y-m-d H:i" }}</td>
      <td>
  {% if en.grade %}
    <span class="badge bg-{{ en.grade.get_score_color }}">{{ en.grade.score }}</span>
  {% else %}
    <span class="badge bg-secondary">-</span>
  {% endif %}
</td>
      <td>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'update_grade' en.id %}">Оценка</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="5">Нет участников</td></tr>
    {% endfor %}
  </tbody>
</table>

<hr>
<h4>Записать студента на курс</h4>
<form method="post" class="row g-2">
  {% csrf_token %}
  <div class="col-auto" style="min-width:220px;">
    {{ form.student }}
  </div>
  <div class="col-auto">
    <button class="btn btn-success">Записать</button>
  </div>
</form>

{% endblock %}